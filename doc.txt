
```
VUDS-Al-application 核心實作分析
================================

一、核心文件架構
---------------
主要處理流程由三個核心 Python 文件組成：
1. extract_templates.py -> 2. process_report.py -> 3. build_dataset.py

二、各階段詳細分析
----------------

1. extract_templates.py - 模板提取階段
------------------------------------
主要職責：從原始圖像中提取標準化的模板數據

A. 模板配置管理
- 讀取 template_config.json 配置文件
- 定義關鍵標籤和單位（如 Maximum Flow, Average Flow 等）
- 設置輸出目錄結構（pftg, pfus, pfs, xray）

B. 圖像處理流程
- 使用 PaddleOCR 進行文字識別
- 提取四種關鍵區域：
  * PFTG (Pressure Flow Test Graph)
  * PFUS (Pressure Flow Uroflow Segment)
  * PFS (Pressure Flow Summary)
  * X-ray 圖像
- 使用 layoutparser 進行版面分析
- 生成標註圖像用於調試

C. 數據提取
- 從 PFS 區域提取數值到 CSV
- 保存各個區域的圖像
- 生成標註圖像

2. process_report.py - 報告處理階段
---------------------------------
主要職責：處理提取出的模板數據，識別關鍵標籤和勾選項

A. 標籤處理
- 定義 10 個關鍵標籤：
  * Detrusor instability（逼尿肌不穩定）
  * Flow pattern（尿流模式）
  * EMG: ES relaxation（肌電圖：外括約肌放鬆）
  * 其他 X-ray 相關標籤
- 實現勾選框檢測算法
- 標籤值映射（如 Yes/No 轉換為 1/0）

B. 報告處理流程
- PDF 轉圖像
- OCR 文字識別
- 勾選框檢測
- 標籤提取和驗證
- 生成結構化輸出

C. 批量處理
- 支持批量處理報告
- 錯誤日誌記錄
- 處理狀態追蹤

3. build_dataset.py - 數據集構建階段
----------------------------------
主要職責：將處理後的數據組織成標準化的數據集

A. 數據集組織
- 將數據分為四類：
  * pftg：Detrusor_instability 標籤
  * pfus：Flow_pattern, EMG_ES_relaxation 標籤
  * xray：7 個 X-ray 相關標籤
  * pfs：圖片和 CSV 路徑

B. 數據標準化
- 生成標準化的 CSV 文件
- 組織圖像文件結構
- 生成標籤統計信息

C. 輸出結構
processed_dataset/
├── images/
│   ├── pftg/
│   ├── pfus/
│   ├── pfs/
│   └── xray/
└── metadata/
    ├── pftg_samples.csv
    ├── pfus_samples.csv
    ├── pfs_samples.csv
    └── xray_samples.csv

三、整體工作流程
--------------
1. extract_templates.py
   - 輸入：原始 PDF/圖像
   - 輸出：提取的模板圖像和 CSV 數據
   - 目的：標準化數據提取

2. process_report.py
   - 輸入：模板提取的結果
   - 輸出：結構化的標籤數據
   - 目的：識別和驗證關鍵標籤

3. build_dataset.py
   - 輸入：處理後的報告數據
   - 輸出：標準化的訓練數據集
   - 目的：生成機器學習可用的數據集

四、關鍵技術特點
--------------
1. 使用 PaddleOCR 進行文字識別
2. 實現了精確的勾選框檢測算法
3. 使用 layoutparser 進行版面分析
4. 模組化設計，便於維護和擴展
5. 完整的錯誤處理和日誌記錄
6. 標準化的數據輸出格式

五、注意事項
----------
1. 系統處理的是敏感的醫療數據，需要確保數據安全和隱私保護
2. 系統的準確性對於醫療診斷至關重要，建議在使用前進行充分的驗證和測試
3. 每個階段都有明確的職責和輸出，確保數據處理的可追溯性
4. 系統設計考慮了醫療報告的特殊性，適合用於後續的醫療分析工作
```

您可以將上述內容複製到 Notepad 中保存。這個筆記包含了完整的系統分析，包括：
- 核心文件架構
- 各階段的詳細分析
- 整體工作流程
- 關鍵技術特點
- 重要注意事項
